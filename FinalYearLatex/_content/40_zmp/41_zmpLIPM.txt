Rather than constraining the CoM of the robot during locomotion, the better approach is 
to control it, using the position of an inverted pendulum. This approached was developed and 
implemented by Shuuji Kajita \citep{kajita_2003_biped} in the early 2000s. 

\subsubsection*{ZMP simplification}

The inverted pendulum simplifies VukobratoviÄ‡'s ZMP by assuming that the ankle 
about which the torque is applied intersects with the ground. This intersection forms the base of the
pendulum and origin of the coordinate system in which the pendulum is defined. 
It is also assumed that the robot is capable of generating sufficient torque about 
the ankle in order to shift the position of the CoM. The mass of the foot is ignored, while the assumption
that friction holds the foot in place is retained. These simplifications yield equation 
\ref{eq:simpZMP} from \ref{eq:ZMP_F} and \ref{eq:ZMP_M}.

\begin{equation}
    \mathbf{0} = \vec{BP} \times \mathbf{R_{xyz}} + \mathbf{M_{A}}
\end{equation}\label{eq:simpZMP}

$\mathbf{A}$ intersects with the ground, becoming the fulcrum of the pendulum. 
$R_{y}$ balances $F_{\mathbf{A}y}$ and thus $R_{y} = mg$, where $m$ is the mass of the robot. 
As the horizontal components of $\mathbf{F_{A}}$ are balanced by the horizontal friction components 
of $\mathbf{R_{xyz}}$, equation \ref{eq:simpZMP} can be solved for the ZMP$(x,z)$ as follows:

\begin{align}
    p_x &= \frac{-\tau_z}{mg}   \label{eq:zmpx} \\
    p_z &= \frac{\tau_x}{mg}    \label{eq:zmpz}   
\end{align}

Equations \ref{eq:zmpx} and \ref{eq:zmpz} determine the relationship between the horizontal components
of $\mathbf{M_{A}}$ ($\tau_x, \tau_z$), the mass of the robot, and the Zero Moment Point, with respect to the fulcrum of
a pendulum.

\subsubsection*{Inverted Pendulum Derivation}

The mass of the pendulum generates unbalanced torques about the $X$ and $Z$ axes. This is demonstrated
in figure \ref{fig:LIPM}, with the weight force $mg$ passing through the pendulum and the resulting 
torques, ${\tau}_{mgz}$ and ${\tau}_{mgx}$, shown red. Additional torques due
to the movement of the pendulum in the $XZ$ plane have been omitted for clarity, but contribute
to the destabilising torques shown in red.

\begin{figure}[!h]
    \begin{center}
        \includegraphics[width=.65\linewidth]{_content/40_zmp/fig_LIPM_labelled_true.png}
        \caption{Inverted Pendulum}\label{fig:LIPM}
    \end{center}
\end{figure}

In order to return the pendulum to vertical equilibrium, opposing torques 
must be applied about the $X$ and $Z$ axes. These, alongside their equivalent accelerations,
$a_z$ and $a_x$, are shown in blue. The point $\mathbf{P}$, depicted in purple, is the $(x,z)$ position of 
the pendulum. Equation \ref{eq:Init_LIPM} includes the omitted planar accelerations of the pendulum, 
$\ddot x$ and $\ddot z$, in the determination of the $\mathbf{P}(x,z)$ as a function of restoring torques, 
${\tau}_{z} = a_{x} y $ and ${\tau}_{x} = a_{z} y$.

\begin{align}\label{eq:Init_LIPM}
    \mathbf{P}{(x,z)} = \begin{bmatrix}
        {(mg)}^{-1} {({\tau}_{z} - m y \ddot x)}   \\
        {(mg)}^{-1} {({\tau}_{x} - m y \ddot z)}
    \end{bmatrix}
\end{align}

\begin{equation}\label{eq:LIPM_stateCT}
    \begin{split}
        \frac{\delta}{\delta t}
        \begin{bmatrix}
            x           \\
            \dot{x}     \\ 
            \ddot{x} 
        \end{bmatrix}&=
        \begin{bmatrix}
            0 & 1 & 0   \\
            0 & 0 & 1   \\ 
            0 & 0 & 0
        \end{bmatrix}
        \begin{bmatrix}
            x           \\
            \dot{x}     \\ 
            \ddot{x} 
        \end{bmatrix} + 
        \begin{bmatrix}
            0   \\
            0   \\ 
            1 
        \end{bmatrix} u_{(x,y)}\\
        \mathbf{p}_{(x,y)}&= 
        \begin{bmatrix}
            1 & 0 & \frac{-y_{c}}{g}
        \end{bmatrix}
        \begin{bmatrix}
            x           \\
            \dot{x}     \\ 
            \ddot{x} 
        \end{bmatrix}
    \end{split}
\end{equation}

\begin{equation}\label{eq:LIPM_stateDT}
    \begin{split}
        \mathbf{x}_{(k+1)} &= \mathbf{A_d}\mathbf{x}_k+\mathbf{B_d}\mathbf{u}_k\\
        \mathbf{p}_k &= \mathbf{C_d}\mathbf{x}_k \\
    \end{split}
\end{equation}
... where:
\begin{equation}\label{eq:LIPM_discrete}
    \begin{aligned}
        \mathbf{A_d} =
        \begin{bmatrix}
            1 & T & \frac{T^{2}}{2} \\
            0 & 1 & T               \\ 
            0 & 0 & 1
        \end{bmatrix}
    \end{aligned} \:\:
    \begin{aligned}
        \mathbf{B_d} =
        \begin{bmatrix}
            \frac{T^{3}}{6} \\ \frac{T^{2}}{2} \\ T
        \end{bmatrix}
    \end{aligned} \:\:
    \begin{aligned}
        \mathbf{C_d} =
        \begin{bmatrix}
            1 & 0 & \frac{-y_{c}}{g}
        \end{bmatrix}
    \end{aligned}
\end{equation}
